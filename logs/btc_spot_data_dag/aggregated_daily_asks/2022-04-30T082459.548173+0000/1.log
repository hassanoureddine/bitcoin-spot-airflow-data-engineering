[2022-04-30 08:25:10,397] {taskinstance.py:1043} INFO - Dependencies all met for <TaskInstance: btc_spot_data_dag.aggregated_daily_asks manual__2022-04-30T08:24:59.548173+00:00 [queued]>
[2022-04-30 08:25:10,410] {taskinstance.py:1043} INFO - Dependencies all met for <TaskInstance: btc_spot_data_dag.aggregated_daily_asks manual__2022-04-30T08:24:59.548173+00:00 [queued]>
[2022-04-30 08:25:10,411] {taskinstance.py:1249} INFO - 
--------------------------------------------------------------------------------
[2022-04-30 08:25:10,411] {taskinstance.py:1250} INFO - Starting attempt 1 of 1
[2022-04-30 08:25:10,412] {taskinstance.py:1251} INFO - 
--------------------------------------------------------------------------------
[2022-04-30 08:25:10,431] {taskinstance.py:1270} INFO - Executing <Task(BigQueryOperator): aggregated_daily_asks> on 2022-04-30 08:24:59.548173+00:00
[2022-04-30 08:25:10,436] {standard_task_runner.py:52} INFO - Started process 3162 to run task
[2022-04-30 08:25:10,440] {standard_task_runner.py:79} INFO - Running: ['***', 'tasks', 'run', 'btc_spot_data_dag', 'aggregated_daily_asks', 'manual__2022-04-30T08:24:59.548173+00:00', '--job-id', '37', '--raw', '--subdir', 'DAGS_FOLDER/my_dag.py', '--cfg-path', '/tmp/tmpfglipn8x', '--error-file', '/tmp/tmpmho1xg4p']
[2022-04-30 08:25:10,442] {standard_task_runner.py:80} INFO - Job 37: Subtask aggregated_daily_asks
[2022-04-30 08:25:10,517] {logging_mixin.py:109} INFO - Running <TaskInstance: btc_spot_data_dag.aggregated_daily_asks manual__2022-04-30T08:24:59.548173+00:00 [running]> on host 7356a9a87c5b
[2022-04-30 08:25:10,588] {taskinstance.py:1448} INFO - Exporting the following env vars:
AIRFLOW_CTX_DAG_OWNER=***
AIRFLOW_CTX_DAG_ID=btc_spot_data_dag
AIRFLOW_CTX_TASK_ID=aggregated_daily_asks
AIRFLOW_CTX_EXECUTION_DATE=2022-04-30T08:24:59.548173+00:00
AIRFLOW_CTX_DAG_RUN_ID=manual__2022-04-30T08:24:59.548173+00:00
[2022-04-30 08:25:10,589] {bigquery.py:655} INFO - Executing: select sum(asks.size) from `btcspot.btcspot.asks` as asks group by timestamp;
[2022-04-30 08:25:10,590] {connection.py:407} ERROR - Unable to retrieve connection from secrets backend (EnvironmentVariablesBackend). Checking subsequent secrets backend.
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/models/connection.py", line 400, in get_connection_from_secrets
    conn = secrets_backend.get_connection(conn_id=conn_id)
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/secrets/base_secrets.py", line 64, in get_connection
    conn_uri = self.get_conn_uri(conn_id=conn_id)
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/secrets/environment_variables.py", line 33, in get_conn_uri
    environment_uri = os.environ.get(CONN_ENV_PREFIX + conn_id.upper())
AttributeError: 'dict' object has no attribute 'upper'
[2022-04-30 08:25:10,599] {connection.py:407} ERROR - Unable to retrieve connection from secrets backend (MetastoreBackend). Checking subsequent secrets backend.
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1277, in _execute_context
    cursor, statement, parameters, context
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/default.py", line 608, in do_execute
    cursor.execute(statement, parameters)
psycopg2.ProgrammingError: can't adapt type 'dict'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/models/connection.py", line 400, in get_connection_from_secrets
    conn = secrets_backend.get_connection(conn_id=conn_id)
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/utils/session.py", line 70, in wrapper
    return func(*args, session=session, **kwargs)
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/secrets/metastore.py", line 36, in get_connection
    conn = session.query(Connection).filter(Connection.conn_id == conn_id).first()
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/orm/query.py", line 3429, in first
    ret = list(self[0:1])
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/orm/query.py", line 3203, in __getitem__
    return list(res)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/orm/query.py", line 3535, in __iter__
    return self._execute_and_instances(context)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/orm/query.py", line 3560, in _execute_and_instances
    result = conn.execute(querycontext.statement, self._params)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1011, in execute
    return meth(self, multiparams, params)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/sql/elements.py", line 298, in _execute_on_connection
    return connection._execute_clauseelement(self, multiparams, params)
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1130, in _execute_clauseelement
    distilled_params,
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1317, in _execute_context
    e, statement, parameters, cursor, context
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1511, in _handle_dbapi_exception
    sqlalchemy_exception, with_traceback=exc_info[2], from_=e
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/util/compat.py", line 182, in raise_
    raise exception
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/base.py", line 1277, in _execute_context
    cursor, statement, parameters, context
  File "/home/airflow/.local/lib/python3.7/site-packages/sqlalchemy/engine/default.py", line 608, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.ProgrammingError: (psycopg2.ProgrammingError) can't adapt type 'dict'
[SQL: SELECT connection.password AS connection_password, connection.extra AS connection_extra, connection.id AS connection_id, connection.conn_id AS connection_conn_id, connection.conn_type AS connection_conn_type, connection.description AS connection_description, connection.host AS connection_host, connection.schema AS connection_schema, connection.login AS connection_login, connection.port AS connection_port, connection.is_encrypted AS connection_is_encrypted, connection.is_extra_encrypted AS connection_is_extra_encrypted 
FROM connection 
WHERE connection.conn_id = %(conn_id_1)s 
 LIMIT %(param_1)s]
[parameters: {'conn_id_1': {'type': 'service_account', 'project_id': 'btcspot', 'private_key_id': '99d52a287afd4b97f04e3088a9f0abba397dfa36', 'private_key': '-----BEGIN PRIVATE  ... (1999 characters truncated) ... uth2/v1/certs', 'client_x509_cert_url': 'https://www.googleapis.com/robot/v1/metadata/x509/python-bigquery-btcspot%40btcspot.iam.gserviceaccount.com'}, 'param_1': 1}]
(Background on this error at: http://sqlalche.me/e/13/f405)
[2022-04-30 08:25:10,618] {taskinstance.py:1774} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/providers/google/cloud/operators/bigquery.py", line 661, in execute
    impersonation_chain=self.impersonation_chain,
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/providers/google/cloud/hooks/bigquery.py", line 108, in __init__
    impersonation_chain=impersonation_chain,
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/providers/google/common/hooks/base_google.py", line 219, in __init__
    self.extras = self.get_connection(self.gcp_conn_id).extra_dejson  # type: Dict
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/hooks/base.py", line 68, in get_connection
    conn = Connection.get_connection_from_secrets(conn_id)
  File "/home/airflow/.local/lib/python3.7/site-packages/airflow/models/connection.py", line 410, in get_connection_from_secrets
    raise AirflowNotFoundException(f"The conn_id `{conn_id}` isn't defined")
airflow.exceptions.AirflowNotFoundException: The conn_id `{'type': 'service_account', 'project_id': 'btcspot', 'private_key_id': '99d52a287afd4b97f04e3088a9f0abba397dfa36', 'private_key': '-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCo0+zp1BDgs/Fp\nyboLIK8dOGCtM+5NzBtbH1qWDpUmYNZfioWSiggGzKnZSi1bhiiRhIwsk0UQLK6d\nSzYkB+D5FRdtjqgdyqVFy99b94FKWPLIwS9GXXlCLCm6ptSiC+S6pipPyJcqjmdw\nO4D+gIWtljK8CZZ8D5JEQK8UaT5hy8HnNqnfrDiVWq1ZLSRozcPK1r5pG9HcHNj0\nF0khsIrOU8EX3i4IPXP6GJ9gICHqZT1Qw17RvJc1H6WSE5At8VsMPlOofRaBcvyh\n0YSBqa7b9uQqwCmO/Tk4Jq0+vS2cehxP7qZ6Sah7sZNeeEc/C3GgHoRnLMh05Xjj\n2J70ZbKLAgMBAAECggEAOedRutMKpN7inltbTUS8+sMi2VTV12X5PfQPgCbpPdv5\nupQKgvuHjDl2yblYvCrT0DELWKB8D/ObQgSRQaNYJGX4/pDulSUzMTCe326Qr/y4\n7GThv3sAw1LdTxC4HgoBPYkPOwT739Muo/4snF1dO++nX/nT3KIEkxcyVUhRZn3K\noPBVQlGCiDc5agTMzXSQCJzpjv2gyc4aizr8KY6CIZcvk27Z2WGe839PWwzvJI4o\ndeA0dvUMDEtalMuCLpjh81s0SolKb1d9UYFlyNX4IFkFopgWbm381dELRGapmFdk\nXyeatQ7a/Nfv0e3AKuHxvaIZ2LlbAQ6pg6zTzg09QQKBgQDcIAQwHFzTKK2hvLRG\nRDrbDK9CWUwSIilZYaJ+PgTXbSnFOcNtnYOEIBC8YPH1A3ortB8HmDe+Nldopjmq\nCWKFOh2XosoyBndP/AOwhKbLlvSF50gvJS5s4s0bvOtmsgLZ8TOojp6RiYg/dVsL\nV2JV1RZ1GyCWKeIpDKW7Oq3KSwKBgQDEV7QPL+QyhhUPps+h6ImTazmBioK1nRHI\nqfl6QOlwcbzBEGCKjgzXL+V+O5RbV2rAqES2oUBXfDHyrHJX37LEe9jz2tuGEA0T\nQihhSoL85D7FVwKLT9GS+V3cdELtrcpLlVYIv/S7QVQRx+tvC+TZWn82pJclu1S8\n57cCgwKQwQKBgQDFnwTDgKMhe/KuMrESKG1CfVfW1D6ERSEkOpBckCdelIWcqCg4\nf+Izu2nrBYoT8uQ62kHFWrYo0baVoC5C5pwJicxJd3/Ze46gQ1u4nM72Fnc+xA49\nLT9JyDBmR6x7DTOcIHzFRg08EeI9PonXW8NP1beMuSb/SWjee5lKxvqBkwKBgFkr\ni7cqBPV9N6t4Euxxc6nkFKXkhiB9SUpdB9SiDmLnBNaZ3X6PrP0933hJDsO9G9qL\nkUlwSoxw9y5Da1rFWacqqAl36CMmvwl0DmrBMGQyNN/i+GDUy1V4s0wf8RWIzEsv\nc3dd1oQE022P4jj4qeKc2xGyBoM4ZO+2PMODRHMBAoGBALjfgaeVKYLDUqm+y71x\nOO8S7RTG+PAz0kNa7KlzUEqXe9xiwB05ZfolaS+TE1OiljYC9SvJId3k7FE/DPx0\n88piUEM1NuMB/OefbdowTtW1MzVJHxy1OQabnUJjfjszIEJHt+S7oEuTHaUuAcYO\nnlzB+/HC7JAlJ8AqdQvJv45P\n-----END PRIVATE KEY-----\n', 'client_email': 'python-bigquery-btcspot@btcspot.iam.gserviceaccount.com', 'client_id': '110015444255436857580', 'auth_uri': 'https://accounts.google.com/o/oauth2/auth', 'token_uri': 'https://oauth2.googleapis.com/token', 'auth_provider_x509_cert_url': 'https://www.googleapis.com/oauth2/v1/certs', 'client_x509_cert_url': 'https://www.googleapis.com/robot/v1/metadata/x509/python-bigquery-btcspot%40btcspot.iam.gserviceaccount.com'}` isn't defined
[2022-04-30 08:25:10,629] {taskinstance.py:1288} INFO - Marking task as FAILED. dag_id=btc_spot_data_dag, task_id=aggregated_daily_asks, execution_date=20220430T082459, start_date=20220430T082510, end_date=20220430T082510
[2022-04-30 08:25:10,646] {standard_task_runner.py:98} ERROR - Failed to execute job 37 for task aggregated_daily_asks (The conn_id `{'type': 'service_account', 'project_id': 'btcspot', 'private_key_id': '99d52a287afd4b97f04e3088a9f0abba397dfa36', 'private_key': '-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCo0+zp1BDgs/Fp\nyboLIK8dOGCtM+5NzBtbH1qWDpUmYNZfioWSiggGzKnZSi1bhiiRhIwsk0UQLK6d\nSzYkB+D5FRdtjqgdyqVFy99b94FKWPLIwS9GXXlCLCm6ptSiC+S6pipPyJcqjmdw\nO4D+gIWtljK8CZZ8D5JEQK8UaT5hy8HnNqnfrDiVWq1ZLSRozcPK1r5pG9HcHNj0\nF0khsIrOU8EX3i4IPXP6GJ9gICHqZT1Qw17RvJc1H6WSE5At8VsMPlOofRaBcvyh\n0YSBqa7b9uQqwCmO/Tk4Jq0+vS2cehxP7qZ6Sah7sZNeeEc/C3GgHoRnLMh05Xjj\n2J70ZbKLAgMBAAECggEAOedRutMKpN7inltbTUS8+sMi2VTV12X5PfQPgCbpPdv5\nupQKgvuHjDl2yblYvCrT0DELWKB8D/ObQgSRQaNYJGX4/pDulSUzMTCe326Qr/y4\n7GThv3sAw1LdTxC4HgoBPYkPOwT739Muo/4snF1dO++nX/nT3KIEkxcyVUhRZn3K\noPBVQlGCiDc5agTMzXSQCJzpjv2gyc4aizr8KY6CIZcvk27Z2WGe839PWwzvJI4o\ndeA0dvUMDEtalMuCLpjh81s0SolKb1d9UYFlyNX4IFkFopgWbm381dELRGapmFdk\nXyeatQ7a/Nfv0e3AKuHxvaIZ2LlbAQ6pg6zTzg09QQKBgQDcIAQwHFzTKK2hvLRG\nRDrbDK9CWUwSIilZYaJ+PgTXbSnFOcNtnYOEIBC8YPH1A3ortB8HmDe+Nldopjmq\nCWKFOh2XosoyBndP/AOwhKbLlvSF50gvJS5s4s0bvOtmsgLZ8TOojp6RiYg/dVsL\nV2JV1RZ1GyCWKeIpDKW7Oq3KSwKBgQDEV7QPL+QyhhUPps+h6ImTazmBioK1nRHI\nqfl6QOlwcbzBEGCKjgzXL+V+O5RbV2rAqES2oUBXfDHyrHJX37LEe9jz2tuGEA0T\nQihhSoL85D7FVwKLT9GS+V3cdELtrcpLlVYIv/S7QVQRx+tvC+TZWn82pJclu1S8\n57cCgwKQwQKBgQDFnwTDgKMhe/KuMrESKG1CfVfW1D6ERSEkOpBckCdelIWcqCg4\nf+Izu2nrBYoT8uQ62kHFWrYo0baVoC5C5pwJicxJd3/Ze46gQ1u4nM72Fnc+xA49\nLT9JyDBmR6x7DTOcIHzFRg08EeI9PonXW8NP1beMuSb/SWjee5lKxvqBkwKBgFkr\ni7cqBPV9N6t4Euxxc6nkFKXkhiB9SUpdB9SiDmLnBNaZ3X6PrP0933hJDsO9G9qL\nkUlwSoxw9y5Da1rFWacqqAl36CMmvwl0DmrBMGQyNN/i+GDUy1V4s0wf8RWIzEsv\nc3dd1oQE022P4jj4qeKc2xGyBoM4ZO+2PMODRHMBAoGBALjfgaeVKYLDUqm+y71x\nOO8S7RTG+PAz0kNa7KlzUEqXe9xiwB05ZfolaS+TE1OiljYC9SvJId3k7FE/DPx0\n88piUEM1NuMB/OefbdowTtW1MzVJHxy1OQabnUJjfjszIEJHt+S7oEuTHaUuAcYO\nnlzB+/HC7JAlJ8AqdQvJv45P\n-----END PRIVATE KEY-----\n', 'client_email': 'python-bigquery-btcspot@btcspot.iam.gserviceaccount.com', 'client_id': '110015444255436857580', 'auth_uri': 'https://accounts.google.com/o/oauth2/auth', 'token_uri': 'https://oauth2.googleapis.com/token', 'auth_provider_x509_cert_url': 'https://www.googleapis.com/oauth2/v1/certs', 'client_x509_cert_url': 'https://www.googleapis.com/robot/v1/metadata/x509/python-bigquery-btcspot%40btcspot.iam.gserviceaccount.com'}` isn't defined; 3162)
[2022-04-30 08:25:10,693] {local_task_job.py:154} INFO - Task exited with return code 1
[2022-04-30 08:25:10,733] {local_task_job.py:264} INFO - 0 downstream tasks scheduled from follow-on schedule check
